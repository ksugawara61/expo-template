pre-push:
  parallel: true
  commands:
    check-staged-files:
      run: |
        if git diff --cached --exit-code > /dev/null; then
          echo "✅ No staged files found. Push is allowed."
        else
          echo "❌ Error: There are staged files that haven't been committed."
          echo "This usually happens when pre-commit hooks format files but the changes aren't committed."
          echo ""
          echo "Staged files:"
          git diff --cached --name-only
          echo ""
          echo "Please commit these changes before pushing:"
          echo "  git add ."
          echo "  git commit --amend --no-edit"
          echo "  # or create a new commit"
          exit 1
        fi
    tests:
      run: pnpm turbo test --filter="...[HEAD~1]"

pre-commit:
  parallel: true
  commands:
    biome-fmt:
      glob: "**/*.{js,ts,jsx,tsx,json}"
      run: pnpm biome check --no-errors-on-unmatched --files-ignore-unknown=true --write --staged
    mobile-eslint-fmt:
      glob: "mobile/**/*.{js,ts,jsx,tsx}"
      run: cd mobile && echo "{staged_files}" | sed 's|mobile/||g' | xargs pnpm eslint --fix
